<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta name="description" content="[MAZ01001.github.io] GIF decoding and rendering with HTML5 canvas">
    <meta name="author" content="MAZ01001">
    <title>GIF decoder</title>
    <link rel="stylesheet" href="style.css">
</head>
<body>
    <noscript>This page needs JavaScript to work</noscript>
    <div id="box">
        <h1 id="gifHeading">GIF<span class="hint" title="Only supports GIF files with version &quot;GIF89a&quot;">*</span> decoder</h1>
        <!-- TODO
            ! warning BEFORE decoding GIFs over ~ 10MiB
            ~ timeTickmarks indicate frame timestamps ~ ignore for user-input-flags
            ~ use offscreen canvas for special disposal method case (3)
            ? auto hide gifView buttons after 1sec no mouse movement (js mouse move) or mouse leaves div (css hover)
            ? useless/verbose stats
            ? (AppExt) raw bytes as hex string (textarea) ~ instead of copy button ? both
            ? maybe add scroll shadows ↓
            ?>> CSS style   https://github.com/MAZ01001/MAZ01001.github.io/blob/master/index.html#L48-L60
            ?>> JS function https://github.com/MAZ01001/MAZ01001.github.io/blob/master/index.html#L250-L270
            ?>> JS event    https://github.com/MAZ01001/MAZ01001.github.io/blob/master/index.html#L318-L320
            ! force-clear-last-frame flag for URL & toggle button left of playback controls (default off)
            ? add [byte position] to title ~ comment, application/unkown extension, and global/local color table
            ? new canvas button to change canvas background/-color
            - >> dialog menu with some options and a live preview
            - >> pause playback and use screenshoot of canvas as preview (slider for screenshoot opacity | image above inputs)
            - >> toggle to use backgroud color index (disabled in OFF state if not available and disables all following inputs if toggled ON)
            - >> color input for background color
            - >> checkbox to toggle checker texture and enable checker color (second color input)
            - >> number input for checker size (~ 1/10 rem)
            ! add `avgAlpha` (`decodeGIF`) to `urlParam`
        -->
        <div id="gifView" title="GIF render canvas">
            <canvas id="htmlCanvas">Your browser does not support the HTML canvas element</canvas>
            <div id="gifViewButtons">
                <input type="button" id="fullWindow" data-toggle="0" title="Toggle canvas fullscreen window" value="⤢">
                <input type="button" id="fitWindow" data-toggle="0" title="Toggle between fit to window (🞕) and actual size (🞑)" value="🞕">
                <input type="button" id="imgSmoothing" data-toggle="0" title="Toggle between pixelated (🙾) and smooth (🙼) image rendering" value="🙾">
            </div>
            <span id="gifFPS" title="Shows FPS for GIF canvas (not related to GIF speed)">fps -</span>
            <div id="gifLoad" title="Shows current decoding progress">
                <p id="gifLoadText">Loading...</p>
                <progress id="gifLoadProgress"></progress>
            </div>
        </div>
        <label for="timeRange" title="Current timestamp (with frame timestamps in tickmarks below)">Time: <input type="range" id="timeRange" list="timeTickmarks" aria-disabled="true" tabindex="-1"> <span id="time">-</span> ms</label>
        <datalist id="timeTickmarks"></datalist>
        <label for="frameRange" title="Current frame index (zero-based)">Frame: <input type="range" id="frameRange" step="1"> <span id="frame">-</span></label>
        <div id="playerControls" class="paused">
            <input type="button" id="seekStart" value="⏮" title="first frame (paused)">
            <input type="button" id="seekPrevious" value="&LeftArrowBar;" title="previous frame (paused)">
            <input type="button" id="reverse" value="⏴" title="reverse play">
            <input type="button" id="pause" value="⏸" title="pause">
            <input type="button" id="play" value="⏵" title="play">
            <input type="button" id="seekNext" value="&RightArrowBar;" title="next frame (paused)">
            <input type="button" id="seekEnd" value="⏭" title="last frame (paused)">
        </div>
        <input type="number" id="speed" value="1" min="0" max="100" step="any" placeholder="1" title="playback speed multiplier [0 to 100] (use arrow keys with shift/ctrl/alt for more precision)">
        <fieldset id="userInputArea"><legend title="If highlighted blue needs user input to continue playback">User input</legend>
            <label for="userInputTimeout" title="Timeout for current frame (if present / when waiting for user input)">Timeout: <progress id="userInputTimeout" value></progress> <span id="userInputTimeoutTime">-</span> ms</label>
            <input type="button" id="userInput" title="Click to continue playing GIF" value="Continue">
            <input type="button" id="userInputLock" data-toggle="0" title="Click to toggle instant user input" value="Lock">
        </fieldset>
        <fieldset id="loopArea"><legend title="Control GIF looping behaviour">Loop override</legend>
            <span title="Shows current and maximum GIF loop amount"><span id="loopText">-</span> Loops</span>
            <input type="button" id="loopForce" data-toggle="0" title="Click to (toggle) force infinite repeats" value="Force infinite">
        </fieldset>
        <div id="infoPanels">
            <input type="button" id="open" value="Open GIF" title="Click to open the import menu">
            <fieldset><legend title="General information about the GIF">GIF info</legend>
                <details open id="detailsGIFInfo"><summary>Click to toggle contents</summary>
                    <div id="gifInfoArea">
                        <table>
                            <tr><th>Name</th><th>Value</th></tr>
                            <tr title="The filename of the GIF currently loaded"><td>Filename</td><td id="fileName">____</td></tr>
                            <tr title="The width*height of the entire GIF"><td>Size</td><td><span id="totalWidth">-</span> * <span id="totalHeight">-</span> px</td></tr>
                            <tr title="The amount of frames in this GIF"><td>Total frames</td><td id="totalFrames">-</td></tr>
                            <tr title="The (maximum) total time of the entire GIF"><td>Total Time</td><td id="totalTime">-</td> ms</tr>
                            <tr title="The Pixel aspect ratio of the GIF"><td>Pixel aspect ratio</td><td id="pixelAspectRatio">-:-</td></tr>
                            <tr title="The color resolution of the GIF"><td>Color resolution</td><td id="colorRes">-</td> bit</tr>
                            <tr title="The index of the color used for the background (if available)"><td>Background color</td><td id="backgroundColorIndex">-</td></tr>
                        </table>
                        <fieldset><legend title="The global color table of the GIF">Global color table</legend>
                            <details open id="detailsGlobalColorTable"><summary>Click to toggle contents</summary>
                                <div id="globalColorTable"><span>Loading...</span></div>
                            </details>
                        </fieldset>
                        <fieldset><legend title="Application-Extensions in the GIF file">Application-Extensions</legend>
                            <details open id="detailsAppExtList"><summary>Click to toggle contents</summary>
                                <div id="appExtList"><span>Loading...</span></div>
                            </details>
                        </fieldset>
                        <fieldset><legend title="Comments in the GIF file and the frame index of where they were found">Comments</legend>
                            <details id="detailsCommentsList"><summary>Click to toggle contents</summary>
                                <div id="commentsList"><span>Loading...</span></div>
                            </details>
                        </fieldset>
                        <fieldset><legend title="Unknown extensions in the GIF file">Unknown extensions</legend>
                            <details id="detailsUnExtList"><summary>Click to toggle contents</summary>
                                <div id="unExtList"><span>Loading...</span></div>
                            </details>
                        </fieldset>
                    </div>
                </details>
            </fieldset>
            <fieldset><legend title="Information of the currently displayed frame">Frame info</legend>
                <details id="detailsFrameView"><summary>Click to toggle frame canvas</summary>
                    <div id="frameView" title="Frame render canvas">
                        <canvas id="htmlFrameCanvas">Your browser does not support the HTML canvas element</canvas>
                        <div id="frameViewButtons">
                            <input type="button" id="frameFullWindow" data-toggle="0" title="Toggle canvas fullscreen window" value="⤢">
                            <input type="button" id="frameFitWindow" data-toggle="0" title="Toggle between fit to window (🞕) and actual size (🞑)" value="🞕">
                            <input type="button" id="frameImgSmoothing" data-toggle="0" title="Toggle between pixelated (🙾) and smooth (🙼) image rendering" value="🙾">
                        </div>
                        <span id="frameFPS" title="Shows FPS for frame canvas (not related to GIF speed)">fps -</span>
                        <div id="frameLoad" title="Shows current decoding progress">
                            <p id="frameLoadText">Loading...</p>
                            <progress id="frameLoadProgress"></progress>
                        </div>
                    </div>
                </details>
                <details id="detailsFrameInfo"><summary>Click to toggle contents</summary>
                    <div id="frameInfoArea">
                        <table>
                            <tr><th>Name</th><th>Value</th></tr>
                            <tr title="The width*height of the current frame"><td>Size</td><td><span id="frameWidth">-</span> * <span id="frameHeight">-</span> px</td></tr>
                            <tr title="The position of the current frame from the left/top edge of the GIF"><td>Position</td><td><span id="frameLeft">-</span> / <span id="frameTop">-</span> px</td></tr>
                            <tr title="How long this frame is displayed for"><td>Time</td><td id="frameTime">- ms</td></tr>
                            <tr title="If the user input flag is set for the current frame"><td>User input flag</td><td><input type="checkbox" id="frameUserInputFlag" disabled></td></tr>
                            <tr title="The index of the color that is used for transparency (if available)"><td>Transparent color</td><td id="transparentColorIndex">-</td></tr>
                            <tr title="The disposal method of the current frame"><td>Disposal method</td><td id="frameDisposalMethod">[- ____]<br>________</td></tr>
                            <tr title="2bits reserved for future use (from a packed field in the image descriptor block)"><td>Reserved field (ID)</td><td id="frameReserved">- (0b00)</td></tr>
                            <tr title="3bits reserved for future use (from a packed field in the graphics control extension block)"><td>Reserved field (GC)</td><td id="frameGCReserved">- (0b000)</td></tr>
                        </table>
                        <fieldset><legend>Local color table</legend>
                            <details open id="detailsFrameColorTable"><summary>Click to toggle contents</summary>
                                <div id="frameColorTable"><span>Loading...</span></div>
                            </details>
                        </fieldset>
                        <fieldset><legend title="Text that is displayed during this frame">Text</legend>
                            <details id="detailsFrameTextInfo"><summary>Click to toggle contents</summary>
                                <div id="frameTextArea">
                                    <table>
                                        <tr><th>Name</th><th>Value</th></tr>
                                        <tr title="The text to display on the current frame"><td>String</td><td id="frameText">____</td></tr>
                                        <tr title="The width*height of the character grid"><td>Grid size</td><td><span id="frameTextWidth">-</span> * <span id="frameTextHeight">-</span> px</td></tr>
                                        <tr title="The position of the character grid from the left/top edge of the GIF"><td>Grid position</td><td><span id="frameTextLeft">-</span> / <span id="frameTextTop">-</span> px</td></tr>
                                        <tr title="The width*height for each cell in the character grid"><td>Character size</td><td><span id="frameTextCharWidth">-</span> * <span id="frameTextCharHeight">-</span> px</td></tr>
                                        <tr title="The foreground color of the text (click to copy hex code)"><td>Foreground</td><td><input type="color" id="frameTextCharForeground"></td></tr>
                                        <tr title="Teh background color of the text (click to copy hex code)"><td>Background</td><td><input type="color" id="frameTextCharBackground"></td></tr>
                                    </table>
                                </div>
                            </details>
                        </fieldset>
                    </div>
                </details>
            </fieldset>
        </div>
    </div>
    <dialog id="importMenu">
        <h2>Import</h2>
        <fieldset><legend title="Load a GIF from URL or a file">Load a GIF file</legend>
            <label for="importURL" title="Load GIF from URL">URL: <input type="url" id="importURL" placeholder="https://example.com/test.gif"></label>
            <p>-- OR --</p>
            <label for="importFile" title="Load local GIF file">File: <input type="file" id="importFile" accept=".gif"></label>
        </fieldset>
        <p id="importWarn"></p>
        <fieldset><legend title="Preview of selected GIF">GIF preview</legend>
            <img id="importPreview" alt="GIF img preview">
        </fieldset>
        <div id="importActions">
            <input type="button" id="importConfirm" disabled value="Start" title="Start decoding GIF">
            <input type="button" id="importAbort" autofocus value="Abort" title="Close import menu">
        </div>
    </dialog>
    <dialog id="confirmMenu">
        <h2>Are you sure?</h2>
        <span id="confirmText">________</span>
        <div>
            <input type="button" id="confirmConfirm" value="OK" title="confirm action">
            <input type="button" id="confirmAbort" value="Abort" title="abort action" autofocus>
        </div>
    </dialog>
    <script src="./script.js"></script>
</body>
</html>
